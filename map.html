<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Display a map</title>
    <meta
      property="og:description"
      content="Initialize a map in an HTML element with MapLibre GL JS."
    />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css"
    />
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      html,
      body,
      #map {
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map" style="height: 800px; width: 600px"></div>
    <script>
      // Examples: https://maplibre.org/maplibre-gl-js/docs/examples/
      const getData = async () => {
        try {
          //const json = await fetch("./plot.json");
          const json = await fetch("./data/geo.json");
          if (!json.ok)
            throw new Error(`HTTP error! status: ${json.status}`);
          const data = await json.json();
          // check if data.data is valid before returning
          console.log(data)
          return data;
        } catch (err) {
          console.error("Error fetching data:", err);
        }
      };

      const datajson = getData();
      console.log(datajson);
      const center = [-34.949739906180845, -8.05176740274159];
      const style =
        "https://basemaps.cartocdn.com/gl/positron-gl-style/style.json";

      const map = new maplibregl.Map({
        container: "map", // container id
        style: style, // style URL
        center: center, // starting position [lng,lat]
        zoom: 14, // starting zoom
        maplibrelogo: true,
      });

      const centerMarker = new maplibregl.Marker({
        color: "#ff0000",
      })
        .setLngLat(center)
        .addTo(map);
      
      const geojson = {
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            properties: {
              message: "Foo",
              iconSize: [60, 60],
            },
            geometry: {
              type: "Point",
              coordinates: [-66.324462890625, -16.024695711685304],
            },
          },
          {
            type: "Feature",
            properties: {
              message: "Bar",
              iconSize: [50, 50],
            },
            geometry: {
              type: "Point",
              coordinates: [-61.2158203125, -15.97189158092897],
            },
          },
          {
            type: "Feature",
            properties: {
              message: "Baz",
              iconSize: [40, 40],
            },
            geometry: {
              type: "Point",
              coordinates: [-63.29223632812499, -18.28151823530889],
            },
          },
        ],
      };

      map.on("load", async () => {
        // Add an image to use as a custom marker
        const image = await map.loadImage(
          "https://maplibre.org/maplibre-gl-js/docs/assets/custom_marker.png"
        );
        map.addImage("custom-marker", image.data);
        // Add a GeoJSON source with 3 points.
        map.addSource("points", {
          type: "geojson",
          data: geojson,
        });

        // Add a symbol layer
        map.addLayer({
          id: "symbols",
          type: "symbol",
          source: "points",
          layout: {
            "icon-image": "custom-marker",
          },
        });

        // Center the map on the coordinates of any clicked symbol from the 'symbols' layer.
        map.on("click", "symbols", (e) => {
          map.flyTo({
            center: e.features[0].geometry.coordinates,
          });
        });

        // Change the cursor to a pointer when the it enters a feature in the 'symbols' layer.
        map.on("mouseenter", "symbols", () => {
          map.getCanvas().style.cursor = "pointer";
        });

        // Change it back to a pointer when it leaves.
        map.on("mouseleave", "symbols", () => {
          map.getCanvas().style.cursor = "";
        });
      });
    </script>
  </body>
</html>
